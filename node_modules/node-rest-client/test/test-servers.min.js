var http=require("http"),fs=require("fs"),httpSrv=http.createServer(function(e,t){console.log("req.url",e.url);RouteManager.findRoute(e,t)}),RouteManager={findRoute:function(e,t){var n=this.routes[e.url];if(!n)throw"cannot find route "+e.url;n.call(this,e,t)},routes:{"/json":function(e,t){var n=fs.readFileSync("./message.json","utf8");t.writeHead(200,{"Content-Type":"application/json"});t.write(n.toString());t.end()},"/xml":function(e,t){var n=fs.readFileSync("./message.xml","utf8");t.writeHead(200,{"Content-Type":"application/xml"});t.write(n.toString());t.end()},"/120/json?arg1=hello&arg2=world":function(e,t){if(!e.headers["test-header"])throw"no test-header found!!";t.setHeader("test-response-header",e.headers["test-header"]);this.routes["/json"](e,t)},"/json?post":function(e,t){e.on("data",function(e){console.log("[SERVER] data = ",e);t.writeHead(200,{"Content-Type":"application/json"});t.write(e.toString());t.end()})}}};httpSrv.on("error",function(e){console.error("error starting http test server",e)});httpSrv.listen(4444);console.log("http server Listening on port 4444");