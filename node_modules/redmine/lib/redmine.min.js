function escapeJSONString(e,t){return typeof t=="string"?t.replace(/[^ -~\b\t\n\f\r"\\]/g,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}):t}function JSONStringify(e){return JSON.stringify(e,escapeJSONString).replace(/\\\\u([\da-f]{4}?)/g,"\\u$1")}function Redmine(e){if(!e.apiKey||!e.host)throw new Error("Error: apiKey and host must be configured.");this.setApiKey(e.apiKey);this.setHost(e.host)}var http=require("http"),https=require("https"),util=require("util"),url=require("url"),querystring=require("querystring");util=require("util");Redmine.prototype.version="0.2.3";Redmine.JSONStringify=JSONStringify;Redmine.prototype.setApiKey=function(e){this.apiKey=e};Redmine.prototype.getApiKey=function(){return this.apiKey};Redmine.prototype.setHost=function(e){this.host=e};Redmine.prototype.getHost=function(){return this.host};Redmine.prototype.generatePath=function(e,t){e.slice(0,1)!="/"&&(e="/"+e);return e+"?"+querystring.stringify(t)};Redmine.prototype.request=function(e,t,n,r){var i,s,o;if(!this.getApiKey()||!this.getHost())throw new Error("Error: apiKey and host must be configured.");i={host:this.getHost(),path:e=="GET"?this.generatePath(t,n):t,method:e,headers:{"X-Redmine-API-Key":this.getApiKey()}},s=https.request(i,function(e){if(e.statusCode!=200&&e.statusCode!=201){r({message:"Server returns stats code: "+e.statusCode,response:e},null);r=null;return}e.setEncoding("utf8");e.on("data",function(e){o+=e});e.on("end",function(e){var t=JSON.parse(o);r(null,t);r=null})});s.on("error",function(e){r(e,null);r=null});if(e!="GET"){o=JSONStringify(n);s.setHeader("Content-Length",o.length);s.setHeader("Content-Type","application/json");s.write(o)}s.end()};Redmine.prototype.getIssue=function(e,t){if(typeof e=="integer")throw new Error("Error: Argument #1 id must be integer");this.request("GET","/issues/"+e+".json?include=journals",{},t)};Redmine.prototype.getIssues=function(e,t){this.request("GET","/issues.json",e,t)};Redmine.prototype.postIssue=function(e,t){this.request("POST","/issues.json",{issue:e},t)};Redmine.prototype.updateIssue=function(e,t,n){this.request("PUT","/issues/"+e+".json",{issue:t},n)};Redmine.prototype.deleteIssue=function(e,t){this.request("DELETE","/issues/"+e+".json",{},t)};module.exports=Redmine;