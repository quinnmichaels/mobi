"use strict";function toggleMenu(){var e=0,t=$("#mobi_menu").height()+e,n=Math.abs(parseFloat($("#panel").css("bottom"))),r=n==0?"-"+t+"px":0;$("#panel").animate({bottom:r})}function viewRotate(){var e=$("#iframe_view"),t=e.css("width"),n=e.css("height");e.animate({width:n,height:t})}var window_timer=0,storage={check:function(e){return localStorage[e]?!0:!1},set:function(e,t){localStorage.setItem(e,JSON.stringify(t))},get:function(e){return JSON.parse(localStorage.getItem(e))},"delete":function(e){localStorage.removeItem(e)}},timer={cur:"",running:{},sec:0,min:0,hr:0,init:function(){},start_stop:function(e){console.log(e);var t="&plus;",n=$(this);timer.cur=e.currentTarget.parentNode.id;console.log(timer.running[timer.cur]);timer.running[timer.cur]||(timer.running[timer.cur]={hr:timer.hr,min:timer.min,sec:timer.sec});n.toggleClass("stop").toggleClass("start");if(n.hasClass("start"))timer.stop();else{console.log("started");timer.start();t="&times;"}n.html(t)},start:function(){var e=$("#"+timer.cur+" > input"),t=timer.running[timer.cur],n=t.hr?t.hr+":":"",r=t.min?t.min+":":"",i=t.sec;console.log(t);n=parseFloat(n)<10?"0"+n:n;r=parseFloat(r)<10?"0"+r:r;i=parseFloat(i)<10?"0"+i:i;e.val(n+r+i);window_timer=setTimeout("timer.start()",1e3);t.sec++;if(t.sec==60){t.sec=0;t.min++}if(t.min==60){t.min=0;t.hr++}},stop:function(){console.log("stop");window.clearTimeout(window_timer)},reset:function(){}},cards={init:function(){var e;storage.check("cards")||storage.set("cards",{});cards.list();$('button[data-action="delete"]').on("click",cards.delete);$("#mobi_menu_container ol").sortable({revert:!0,start:function(t,n){e=$("#"+n.item[0].id);e.addClass("dragging")},stop:function(){e.removeClass("dragging");cards.cardSort()}});$(".card_options_menu").on("click",function(){console.log($(this).height());var e=$(this).height()-18,t=Math.abs(parseFloat($(this).css("bottom"))),n=t==0?"-"+e+"px":0;$(this).animate({bottom:n})});$("#mobi_menu_container ol,#mobi_menu_container li").disableSelection();return!1},cardBlank:function(){return{title:"",page:"",status:"",desc:""}},cardScroll:function(e,t){var n=this.id,r=$("#mobi_menu_cards").width(),i=$("#mobi_menu_cards ol"),s=i.scrollLeft(),o=i.width(),u=411,a=!1,f;switch(n){case"cards_scroll_l":f=Math.abs(s)-u;break;case"cards_scroll_r":f=Math.abs(s+u)}i.animate({scrollLeft:f});console.log(r+" --- "+s+" --- "+o)},cardSort:function(e,t){var n=[],r=storage.get("cards");$("#mobi_menu_container ol li").each(function(){n.push(r[mobi.site][parseFloat(this.id)])});r[mobi.site]=n;storage.set("cards",r)},cardHTML:function(e,t){var n='<div class="card_options_menu"><div class="card_options_button"></div><div class="card_options">';n+='<button data-action="archive" data-id="'+t+'">archive</button>';n+='<button data-action="delete" data-id="'+t+'">delete</button>';n+="</div></div>";var r='<div id="'+t+'-timer" class="timer">';r+='<button class="start_stop start">&plus;</button>';r+='<button class="reset">&oplus;</button>';r+='<input type="text" name="timer" placeholder="00:00:00" value="" readonly="readonly">';r+="</div>";var i=n;i+='<input type="text" name="title" placeholder="title" value="'+e.title+'">';i+=r;i+='<label for="page">page</label><input type="text" name="page" placeholder="*.html" value="'+e.page+'">';i+='<textarea name="desc" placeholder="notes">'+e.desc+"</textarea>";i='<li class="card" id="'+t+'"><div>'+i+"</div></li>";return i},list:function(){var e=storage.get("cards")[mobi.site],t="";for(var n in e)e[n]!=null&&(t+=this.cardHTML(e[n],n+"-card"));$("#mobi_menu_container ol").html(t)},create:function(e){var t,n=$("#add_card").attr("data-state"),r=$("#mobi_menu_container ol"),i=cards.cardHTML(cards.cardBlank(),"new_card");switch(n){case"add":t="close";$("#add_card").html("&times;");r.append(i);$("#new_card > div").fadeIn({duration:200,complete:function(){$('#new_card input[name="title"]').focus()}});break;case"close":t="add";$("#add_card").html("&plus;");$("#new_card").hide().remove()}$("#add_card").attr("data-state",t)},add:function(e,t,n,r){var i=storage.get("cards"),s={title:e,page:t,desc:r,status:n},o=!0;i[mobi.site]||(i[mobi.site]=[]);i[mobi.site].push(s);storage.set("cards",i)},save:function(){console.log("save");var e=$('#new_card [name="title"]').val(),t=$('#new_card [name="page"]').val(),n=$('#new_card [name="status"]').val(),r=$('#new_card [name="desc"]').val();if(e){this.add(e,t,n,r);var i=storage.get("cards")[mobi.site],s=i[i.length-1],o=i.length-1+"-card";this.create();this.list()}},"delete":function(e){console.log(this);var t=storage.get("cards"),n=$(this).data("id");t[mobi.site].splice(parseFloat(n),1);storage.set("cards",t);$("#"+n).hide(175,function(){$(this).remove()})}},mobi={site:$("#iframe_view").attr("src"),init:function(){this.devices.display();mobi.history.init();cards.init()},devices:{list:{fullscreen:{width:"100%",height:"100%"},desktop:{width:"1600px",height:"850px"},ipad:{width:"1024px",height:"768px"},iphone5:{width:"320px",height:"568px"},iphone4:{width:"320px",height:"480px"},galaxy:{width:"360px",height:"640px"},droidtab:{width:"1280px",height:"800px"}},active:function(e){$("#devices ul li").removeClass("active");$("#"+e).attr("class","active");storage.set("view",e)},display:function(){var e="",t=mobi.devices.list;for(var n in t)e+='<li id="'+n+'" class=""><div class="'+n+'">'+n+"</div></li>";$("#devices ul").html(e)},view:function(e){this.active(e);var t=this.list[e],n=$(".content_container");console.log(e);e=="fullscreen"?n.addClass("fullscreen"):n.removeClass("fullscreen");$("#iframe_view").animate({width:t.width,height:t.height})}},history:{init:function(){var e=this.get(),t=e[e.length-1];if(!storage.check("url_history"))storage.set("url_history",[]);else{$("#iframe_view").attr("src",t);$("#url_input").val(t)}mobi.site=$("#iframe_view").attr("src");this.list()},set:function(e){var t=storage.get("url_history"),n=t.indexOf("url");t.push(e);storage.set("url_history",t)},get:function(){var e=storage.get("url_history");if(!e){e=[];storage.set("url_history",e)}return e},list:function(){var e=storage.get("url_history"),t="";e.reverse();for(var n in e)t+='<li><a href="#" class="history_url" data-url="'+e[n]+'">'+e[n]+"</a></li>";$("#history_menu ul").html(t)}},go:function(e){mobi.site=e;var t=$("#iframe_view"),n=$("#url_input");mobi.history.set(e);cards.list();n.blur();t.attr("src",e)},refresh:function(){this.go(mobi.site)}};$(function(){$(document).keypress(function(e){function t(e){mobi.devices.view(e)}console.log(e);console.log(e.which);switch(e.which){case 8710:toggleMenu();break;case 730:var n=Math.abs(parseFloat($("#panel").css("bottom")));console.log(n);n&&toggleMenu();cards.create();break;case 13:e.target.parentNode.offsetParent.id=="new_card"&&cards.save();break;case 186:t("fullscreen");break;case 161:t("desktop");break;case 8482:t("ipad");break;case 163:t("iphone5");break;case 162:t("iphone4");break;case 8734:t("galaxy");break;case 167:t("droidtab");break;case 171:viewRotate()}});$("#modal").draggable();var e=$("#iframe_view");if(!storage.check("view"))mobi.devices.view("fullscreen");else{e.attr("class",storage.get("view"));mobi.devices.active(storage.get("view"))}$("#rotate_iframe").on("click",function(){viewRotate()});$("#frame_reload").on("click",function(e){e.preventDefault();mobi.refresh()});$("#menu_button").on("click",toggleMenu);$("#url_form").submit(function(e){e.preventDefault();var t=$("#url_input").val();mobi.go(t);cards.list()});$("#frame_history").on("click",function(e){e.preventDefault();$("#history_menu").fadeToggle()});$(".history_url").on("click",function(e){e.preventDefault();$("#history_menu").fadeToggle();mobi.go($(this).data("url"))});mobi.init();$("#add_card").on("click",cards.create);$("#devices ul li").on("click",function(e){e.preventDefault();mobi.devices.view(this.id)});$(".timer .start_stop").on("click",timer.start_stop);$(".card_scroll").on("click",cards.cardScroll)});